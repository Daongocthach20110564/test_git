package DAO;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;

import Util.DBConnect;
import Model.invoiceModel;

public class invoiceDAO {
	Connection con = null;
	PreparedStatement ps = null;
	ResultSet rs = null;
	public List<invoiceModel> getAllinvoiceModel() {
        List<invoiceModel> list = new ArrayList<>();
        String query = "select * from Invoice";
        try {
            con = new DBConnect().getConnection();//mo ket noi voi sql
            ps = con.prepareStatement(query);
            rs = ps.executeQuery();
            while (rs.next()) {
                list.add(new invoiceModel(rs.getInt(1),
                        rs.getInt(2),
                        rs.getDouble(3),
                        rs.getDate(4)
                       ));
            }
        } catch (Exception e) {
        }
        return list;
    }
	 public double sumAllinvoiceModel() {
	        String query = "select SUM(tongGia) from Invoice";
	        try {
	            con = new DBConnect().getConnection();//mo ket noi voi sql
	            ps = con.prepareStatement(query);
	            rs = ps.executeQuery();
	            while (rs.next()) {
	               return rs.getDouble(1);
	            }
	        } catch (Exception e) {
	        }
	        return 0;
	    }
	 public List<invoiceModel> searchByNgayXuat(String ngayXuat) {
	        List<invoiceModel> list = new ArrayList<>();
	        String query = "select * from Invoice\r\n"
	        		+ "where [ngayXuat] ='"+ngayXuat+"'";
	        try {
	            con = new DBConnect().getConnection();//mo ket noi voi sql
	            ps = con.prepareStatement(query);
//	            ps.setString(1,ngayXuat);
	            rs = ps.executeQuery();
	            while (rs.next()) {
	                list.add(new invoiceModel(rs.getInt(1),
	                        rs.getInt(2),
	                        rs.getDouble(3),
	                        rs.getDate(4)
	                       ));
	            }
	        } catch (Exception e) {
	        }
	        return list;
	    }
	 public void deleteinvoiceModelByAccountId(String id) {
	        String query = "delete from Invoice\n"
	                + "where [accountID] = ?";
	        try {
	            con = new DBConnect().getConnection();//mo ket noi voi sql
	            ps = con.prepareStatement(query);
	            ps.setString(1, id);
	            ps.executeUpdate();
	        } catch (Exception e) {
	        }
	    }
	 public void insertinvoiceModel(int accountID, double tongGia) {
	        String query = "insert Invoice(accountID,tongGia,ngayXuat)\r\n"
	        		+ "values(?,?,?)";

	        try {
	            con = new DBConnect().getConnection();//mo ket noi voi sql
	            ps = con.prepareStatement(query);
	            ps.setInt(1, accountID);
	            ps.setDouble(2, tongGia);
	            ps.setDate(3,getCurrentDate());
	            ps.executeUpdate();
	           
	        } catch (Exception e) {	
	        	
	        }
	    }
	 private static java.sql.Date getCurrentDate() {
	        java.util.Date today = new java.util.Date();
	        return new java.sql.Date(today.getTime());
	    }
}
